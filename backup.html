<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Backup e RestauraÃ§Ã£o do Sistema</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    h1 { text-align: center; }
    .backup-container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    button, label {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      text-align: center;
    }
    button:hover, label:hover { background: #45a049; }
    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <div class="backup-container">
    <h1>Backup e RestauraÃ§Ã£o</h1>

    <button onclick="fazerBackupGeral()">ðŸ“¦ Backup Geral (Tudo)</button>

    <hr>

    <label for="arquivoBackup">ðŸ”„ Restaurar Backup</label>
    <input type="file" id="arquivoBackup" accept=".json" onchange="restaurarBackup(event)">
  </div>

  <script>
    // FunÃ§Ã£o para gerar backup geral
    function fazerBackupGeral() {
      const chaves = ['vendedores', 'vendas', 'despesas', 'receitas', 'debitos'];
      const backup = {};

      chaves.forEach(chave => {
        const valor = localStorage.getItem(chave);
        backup[chave] = valor ? JSON.parse(valor) : null;
      });

      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'backup_geral.json';
      link.click();
    }

    // FunÃ§Ã£o para restaurar backup
    function restaurarBackup(event) {
      const arquivo = event.target.files[0];
      if (!arquivo) {
        alert("Nenhum arquivo selecionado.");
        return;
      }

      const leitor = new FileReader();
      leitor.onload = function(e) {
        try {
          const dados = JSON.parse(e.target.result);

          if (typeof dados !== "object" || Array.isArray(dados)) {
            alert("Arquivo de backup invÃ¡lido!");
            return;
          }

          Object.keys(dados).forEach(chave => {
            if (dados[chave] !== null) {
              localStorage.setItem(chave, JSON.stringify(dados[chave]));
            }
          });

          alert("Backup restaurado com sucesso!");
          location.reload(); // recarrega para aplicar dados
        } catch (erro) {
          alert("Erro ao restaurar backup: " + erro.message);
        }
      };
      leitor.readAsText(arquivo);
    }
  </script>
</body>
</html>
